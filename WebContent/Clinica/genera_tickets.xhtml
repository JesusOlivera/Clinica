<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions">

<ui:composition template="/WEB-INF/plantillas/plantilla.xhtml">

	<ui:define name="contenido">
	
		<p:panel>
			
			<h:form>
				<p:breadCrumb>  
    				<p:menuitem value="Home" url="#" />  
    				<p:menuitem value="Clinica" url="#" />
    				<p:menuitem value="Gestion de Tickets" url="generaTicket" />   
				</p:breadCrumb>	
			</h:form>
			
			
			<br/>
			<!-- growl general -->			
			<p:messages  id="msgGeneral" showDetail="false" showSummary="true" closable="true" />		
			
			<!-- tootlbar -->
			<h:form style="margin-bottom: 8px">
				<h:panelGrid columns="4">						
					<p:commandButton value="Nuevo Ticket" icon="icon-add" update=":dlgDetNuevoTicket" oncomplete="PF('dlgNuevoTicket').show();"
						actionListener="#{generaTicketMB.nuevoTicket}"/>
				</h:panelGrid>
			</h:form>
			
				<!-- listado de Planes -->
			<h:form id="formLista">
				<p:dataTable id="dataTicket" var="p" value="#{generaTicketMB.listTickets}" widgetVar="dtTicket" 
					emptyMessage="No hay Tickets Disponibles." rowIndexVar="nro" 
					 style="FONT-SIZE: 10px; width: 1200px">
					<f:facet name="header">Lista Tickets</f:facet>
										
							<p:column headerText="Orden" style="width:15px" >
								#{nro+1}
							</p:column>					
					        
							<p:column style="width:70px" headerText="Ticket">
								<h:outputText value="#{p.nro_ticket}"/>
							</p:column>
							
							<p:column style="width:100px" headerText="Servicio">
								<h:outputText value="#{p.desServicio}"/>
							</p:column>
							
							<p:column width="80px" headerText="Controles">
								<p:commandButton value="Ver Controles" rendered="#{p.id_tipo_servicio eq '1'}"/>
							</p:column>
							
							<p:column width="150px" headerText="Medico" >
								<h:outputText value="#{p.desMedico}" />
							</p:column>
						
							<p:column style="width:150px" headerText="Paciente">
								<h:outputText value="#{p.desPaciente}"/>
							</p:column>
							
							<p:column style="width:70px" headerText="Fecha Emisión" >
								<h:outputText value="#{p.fecha_ticket}"><f:convertDateTime pattern="dd/MM/yyyy" /></h:outputText>
							</p:column>
							
							<p:column style="width:70px" headerText="Hora Emisión">
								<h:outputText value="#{p.hora_ticket}"><f:convertDateTime pattern="HH:mm" /></h:outputText>
							</p:column>
							
							<p:column style="width:50px" headerText="Estado">
								<h:outputText value="#{p.estado}"/>
							</p:column>
							
							<p:column style="width:70px" headerText="Facturado Sunat">
								<h:outputText value="#{p.integrado_sunat? 'Si':'No'}"/>
							</p:column>
							<p:column width="150px" headerText="Consulta Médica">
								<p:commandButton value="Genera Consulta Médica" update=":dlgDetConsultaMedica" 
								rendered="#{p.producto.genera_cola  or loginMB.perfilUsuario.cod_perfil eq '54'}" 
								actionListener="#{generaTicketMB.nuevaConsultaMedica(p)}"
										 oncomplete="PF('dlgConsultaMedica').show();"/>
							</p:column>
					
			        
			        <p:column headerText="Editar/Elim." style="width:80px;text-align: center">					
						<p:commandButton title="Editar"  update=":dlgDetNuevoTicket" actionListener="#{generaTicketMB.editarTicket(p)}"
										 oncomplete="PF('dlgNuevoTicket').show();" icon="icon-edit">
						</p:commandButton> 

						<p:commandButton title="Eliminar" oncomplete="PF('dlgEliminarTicket').show();" 
								actionListener="#{generaTicketMB.eliminarTicket(p)}" update=":dlgDetEliminarTicket" icon="icon-delete">
	
						</p:commandButton>	
					</p:column>
					
					<p:column headerText="Comprobante." style="width:80px;text-align: center">					
						<p:commandButton title="Generar Comprobante"  update=":dlgDetNuevoComprobante" 
											actionListener="#{generaTicketMB.prepararComprobante(p)}"
										 	oncomplete="PF('dlgNuevoComprobante').show();" 
										 	icon="icon-facturacion">
						</p:commandButton> 

						
					</p:column>

				</p:dataTable>
			</h:form>
			
			<!-- #############    Dialogos      ################ -->
			
			<!-- #############    TABLA MAESTRA      ################ -->
			
			<!-- dialogo -->
			
			<p:dialog header="Registrar Comprobante" widgetVar="dlgNuevoComprobante" appendTo="@(body)"
					resizable="false" id="dlgDetNuevoComprobante" modal="true">
				<h:form style="margin-bottom: 8px" id="formPN"> 
					<h:panelGrid columns="4">						
						#{"Tipo de Documento:"}						        
						<p:selectOneMenu style="width:200px" value="#{generaTicketMB.comprobanteSelec.tipo_comprobante}"  required="true" 
							requiredMessage="Se necesita un tipo de comprobante" >
							<f:selectItem itemValue="" itemLabel="--Seleccione--"></f:selectItem>
							<f:selectItems value="#{generaTicketMB.listTablaTablasDetallesComprobante}" var="p" itemLabel="#{p.descripcion_largo}" 
								itemValue="#{p.codigo_catalogo}" />
							<p:ajax event="itemSelect" listener="#{generaTicketMB.mostrarDatosCliente()}" update="idValoresCabecera formAccion"/>
						</p:selectOneMenu>
					</h:panelGrid>
					<h:panelGrid id="idValoresCabecera">
						<h:panelGrid columns="3">
								
								<p:selectOneRadio id="cp" value="#{generaTicketMB.cp}" unselectable="true">
						            <f:selectItem itemLabel="CLIENTE" itemValue="CLIENTE" />
						            <f:selectItem itemLabel="PACIENTE" itemValue="PACIENTE" />
						            <p:ajax event="change" listener="#{generaTicketMB.cambioPacienteCliente()}" update=":formPN"></p:ajax>
						        </p:selectOneRadio>	
						        <p:spacer></p:spacer>						
								<p:spacer></p:spacer>
								#{"Cliente:"}
								<h:outputLabel id="clientePojo" value="#{generaTicketMB.nombrePacienteCliente}" 
												disabled="#{generaTicketMB.ingresarCliente}">
								</h:outputLabel>
		                        
		                        <p:outputLabel value=" #{generaTicketMB.comprobanteSelec.cliente.desTipoDocumento}  
		                        					   #{generaTicketMB.comprobanteSelec.cliente.numero_docu_iden_cab}" id="id_nombre"
									style="width:200px ;font-size:15px; color:blue" />	
								
						</h:panelGrid>
						
						<h:panelGrid columns="6" id="pnFields">
						
							#{"Numero del Documento:"} 
							<p:outputLabel value="#{generaTicketMB.comprobanteSelec.numero_serie_documento_cab}" id="numero_documento"
								required="true" label="numero_documento" requiredMessage="Se necesita un numero de documento"
								style="width:200px ;font-size:25px; " disabled="#{generaTicketMB.ingresarCliente}"/>
							
							#{"Fecha de Emisión:"} 
							<p:calendar style="width:200px" readonlyInput="true" value="#{generaTicketMB.comprobanteSelec.fecha_emision_cab}" 
									pattern="dd/MM/yyyy" locale="es" maxdate="#{cicloMB.fechaActual}"
								  navigator="true"  required="true" requiredMessage="Seleccione una fecha de inicio" 
								  disabled="#{generaTicketMB.ingresarCliente}">
								  <p:ajax event="dateSelect" />
							</p:calendar>
							
							#{"Modo Pago:"}						        
							<p:selectOneMenu style="width:200px" 
								required="true" requiredMessage="Se necesita un modo de pago" disabled="#{generaTicketMB.ingresarCliente}">
								<f:selectItem itemValue="" itemLabel="--Seleccione--"></f:selectItem>
								<f:selectItems value="#{generaTicketMB.listModoPagos}" var="p" itemLabel="#{p.descripcion_modo_pago}" 
								itemValue="#{p.id_modo_pago}" />
								<p:ajax event="change" />
							</p:selectOneMenu>
							
							#{"Tipo Operación:"}						        
							<p:selectOneMenu style="width:200px" value="#{generaTicketMB.comprobanteSelec.tipo_operacion_cab}"  
								required="true" requiredMessage="Se necesita un tipo de operacion"  disabled="#{generaTicketMB.ingresarCliente}">
								<f:selectItem itemValue="" itemLabel="--Seleccione--"></f:selectItem>
								<f:selectItems value="#{generaTicketMB.listTablaTablasDetallesOperacion}" var="p" 
									itemLabel="#{p.descripcion_largo}" itemValue="#{p.codigo_catalogo}" />
								<p:ajax event="change"/>
							</p:selectOneMenu>
							
							#{"Hora de Emisión:"} 
							<p:calendar style="width:200px" readonlyInput="true"  value="#{generaTicketMB.comprobanteSelec.hora_emision_cab}" 
									pattern="hh:mm:ss" timeOnly="true" locale="es" maxdate="#{cicloMB.fechaActual}" 
									disabled="#{generaTicketMB.ingresarCliente}"
								  navigator="true"  required="true" requiredMessage="Seleccione una fecha de inicio">
								  <p:ajax event="dateSelect"/>
							</p:calendar>
							
							#{"Vendedor:"}						        
							<p:selectOneMenu style="width:200px" value="#{generaTicketMB.comprobanteSelec.id_vendedor}"  
								required="true" requiredMessage="Se necesita un Canal"  disabled="#{generaTicketMB.ingresarCliente}">
								<f:selectItem itemValue="" itemLabel="--Seleccione--"></f:selectItem>
								<f:selectItems value="#{generaTicketMB.listaVendedores}" var="p" 
									itemLabel="#{p.descripcion_vendedor}" itemValue="#{p.id_vendedor}" />
								<p:ajax event="change"/>
							</p:selectOneMenu>
							
							
							#{"Tipo de Moneda:"}						        
							<p:selectOneMenu style="width:200px" value="#{generaTicketMB.comprobanteSelec.tipo_moneda_cab}"  
								required="true" requiredMessage="Se necesita un domicilio fiscal" disabled="#{generaTicketMB.ingresarCliente}">
								<f:selectItem itemValue="" itemLabel="--Seleccione--"></f:selectItem>
								<f:selectItems value="#{generaTicketMB.listTablaTablasDetallesMoneda}" var="p" 
									itemLabel="#{p.descripcion_largo}" itemValue="#{p.codigo_catalogo}" />
								<p:ajax event="change"/>
							</p:selectOneMenu>
							
							#{"Fecha de Vencimiento:"} 
							<p:calendar style="width:200px" readonlyInput="true" value="#{generaTicketMB.comprobanteSelec.fecha_vencimiento_cab}" 
									pattern="dd/MM/yyyy" locale="es" maxdate="#{cicloMB.fechaActual}"
								  	navigator="true"  required="true" requiredMessage="Seleccione una fecha de inicio" 
								  	disabled="#{generaTicketMB.ingresarCliente}">
								  <p:ajax event="dateSelect"/>
							</p:calendar>
						
						</h:panelGrid>
					
					</h:panelGrid>
				
				</h:form>
				<h:form id="formAccion">
					<p:panel>
						<p:dataTable id="dataComprobante" var="det" value="#{generaTicketMB.listaComprobanteDetalle}" widgetVar="dtComprobante" 
						emptyMessage="No hay Compras Disponibles." rowIndexVar="nro" 
						 style="FONT-SIZE: 10px; ">
						<f:facet name="header">Detalle de Comprobante</f:facet>
						<p:column headerText="Orden" width="25" style="width:3%" >
							#{nro+1}
						</p:column>
						<p:column style="width:70px" headerText="Código de Producto">
							<h:outputText value="#{det.producto.cod_prod_det}"/>
						</p:column>
						<p:column style="width:70px" headerText="Nombre Producto">
							<h:outputText value="#{det.producto.descripcion_prod_det}"/>
						</p:column>
						<p:column style="width:70px" headerText="Cantidad">
							<h:outputText value="#{det.cant_unidades_item_det}" converter="montoDefaultConverter" />
						</p:column>						
						<p:column style="width:70px" headerText="Valor Unitario">
							<h:outputText value="#{det.producto.precio_final_editado_cliente}" converter="montoDefaultConverter" />
						</p:column>
						<p:column style="width:70px" headerText="Sub Total">
							<h:outputText value="#{det.valor_venta_item_det}" converter="montoDefaultConverter" />
						</p:column>
						<p:column style="width:70px" headerText="Tributo">
							<h:outputText value="#{det.suma_tributos_det}" converter="montoDefaultConverter"/>
						</p:column>
						<p:column style="width:70px" headerText="Total">
							<h:outputText value="#{det.precio_venta_unitario_det}" converter="montoDefaultConverter"/>
						</p:column>
					</p:dataTable>
					</p:panel>
					
					<p:panel>
						<h:panelGrid columns="2" border="1" >
					
							#{"Sumatoria Tributos:"}
							<h:outputLabel value="#{generaTicketMB.comprobanteSelec.suma_tributos_cab}" id="sumatoria_tributos"
									style="width:200px;" converter="montoDefaultConverter" />
							#{"Sub Total venta:"}
							<h:outputLabel value="#{generaTicketMB.comprobanteSelec.total_valor_venta_cab}" id="valor_venta"
									style="width:200px;" converter="montoDefaultConverter" />
							#{"Total venta:"}
							<h:outputLabel value="#{generaTicketMB.comprobanteSelec.total_precio_venta_cab}" id="precio_venta"
									style="width:200px;" converter="montoDefaultConverter" />
							#{"Total descuentos:"}
							<h:outputLabel value="0" id="total_descuentos"
									style="width:200px;" converter="montoDefaultConverter"/>
							#{"Sumatoria otros Cargos:"}
							<h:outputLabel value="0" id="otros_cargos"
									style="width:200px;" converter="montoDefaultConverter" />
							#{"Total Anticipos:"}
							<h:outputLabel value="0" id="total_anticipos"
									style="width:200px;" converter="montoDefaultConverter"  />
							#{"Importe total:"}
							<h:outputLabel value="#{generaTicketMB.comprobanteSelec.importe_total_venta_cab}" id="importe_total"
									style="width:200px;" converter="montoDefaultConverter" />
					
						</h:panelGrid>
						
						<h:panelGrid>
					         <p:commandButton value="Generar Comprobante" actionListener="#{generaTicketMB.generarComprobante()}" 
					         	update=":formAccion: :formPN" disabled="#{generaTicketMB.generarComprobante}">
							 </p:commandButton>
						 </h:panelGrid>
					
					</p:panel>
					
				
				</h:form>	
			</p:dialog>
			
			<p:dialog header="Registrar Ticket" widgetVar="dlgNuevoTicket" appendTo="@(body)"
					resizable="false" id="dlgDetNuevoTicket" modal="true">
					
					<h:form id="formTicket">
					<p:messages showDetail="false" showSummary="true" id="msgNuevo" closable="true"/>
					
							<h:panelGrid columns="2">
								#{"Tipo Servicio: "}
								<p:selectOneMenu  value="#{generaTicketMB.ticketSelected.id_tipo_servicio}" style="width:200px;" >
									<f:selectItem itemValue="" itemLabel="--Seleccione--"></f:selectItem>
									<f:selectItems value="#{generaTicketMB.listTipoServicios}" var="p" 
									itemLabel="#{p.descripcion_tipo}" itemValue="#{p.id_tipo_servicio}" />
									<p:ajax listener="#{generaTicketMB.cargarServicios()}" update="cmbServicio"></p:ajax>
								</p:selectOneMenu>	
								
								#{"Servicio: "}
								<p:selectOneMenu id="cmbServicio" value="#{generaTicketMB.ticketSelected.id_producto}" style="width:200px;">
									<f:selectItem itemValue="" itemLabel="--Seleccione--"></f:selectItem>
									<f:selectItems value="#{generaTicketMB.listProductos}" var="p" 
									itemLabel="#{p.descripcion_prod_det}" itemValue="#{p.id_producto}" />
									<p:ajax event="change" listener="#{generaTicketMB.cargaPrecio()}" update="precio"></p:ajax>
								</p:selectOneMenu>
								
								#{"Número de Ticket: "}
								<h:outputLabel value="#{generaTicketMB.ticketSelected.nro_ticket}">
								</h:outputLabel>
								
								#{"DNI"}
								<p:inputText id="dni" value="#{generaTicketMB.pacienteParam.numero_documento}">
						            <p:ajax event="blur" update="dni nombre" listener="#{generaTicketMB.obtenerPaciente()}"/>
						        </p:inputText>
						        
						        #{"Nombres"}
								<p:inputText id="nombre" value="#{generaTicketMB.pacienteParam.nombre}" style="width:225px">
						            <p:ajax event="blur" update="dni nombre" />
						        </p:inputText>
					        </h:panelGrid>
					        
					        <h:panelGrid columns="2">
					        	<h:panelGrid columns="2" >
					        		<p:selectBooleanCheckbox value="#{generaTicketMB.ticketSelected.flag_externo}" itemLabel="Es externo">
						            	<p:ajax event="change"/>
						        	</p:selectBooleanCheckbox>
						        	<p:spacer></p:spacer>
							        #{"Doctor: "}
									<p:selectOneMenu id="cmbMedico" value="#{generaTicketMB.ticketSelected.id_medico}" style="width:200px;">
										<f:selectItem itemValue="" itemLabel="--Seleccione--"></f:selectItem>
										<f:selectItems value="#{generaTicketMB.listMedicos}" var="p" 
										itemLabel="#{p.nombre_medico}" itemValue="#{p.id_medico}" />
										<p:ajax event="change" listener="#{generaTicketMB.cargaEspecialidad}"></p:ajax>
									</p:selectOneMenu>
								</h:panelGrid>
								<h:panelGrid columns="2">
								
									#{"Fecha: "}
									<p:calendar style="width:200px" readonlyInput="true" value="#{generaTicketMB.ticketSelected.fecha_ticket}" pattern="dd/MM/yyyy" locale="es" 
											  navigator="true"  required="true" requiredMessage="Seleccione una fecha" disabled="true">
									</p:calendar>					
									
									#{"Hora:"} 
									<p:calendar style="width:200px" readonlyInput="true"  value="#{generaTicketMB.ticketSelected.hora_ticket}" pattern="hh:mm:ss" timeOnly="true" locale="es" disabled="true"
										navigator="true"  required="true" requiredMessage="Seleccione una hora" >								  
									</p:calendar>
									
									#{"Precio"}
									<h:outputLabel value="#{generaTicketMB.producto.valor_unitario_prod_det}" id="precio"></h:outputLabel>
								</h:panelGrid>
							</h:panelGrid>
						
					<br/>
					<p:commandButton value="Guardar" actionListener="#{generaTicketMB.guardarTicket()}"
						update=":formLista msgNuevo" oncomplete="validarTicket(xhr, status, args), PF('dlgNuevoTicket').hide()" icon="icon-disk" />
					
					<p:commandButton value="Cancelar" type="button" onclick="PF('dlgNuevoTicket').hide()" icon="icon-cancel" />
					</h:form>	
			</p:dialog>
			

			<!-- dialogo eliminar -->	
			<p:confirmDialog id="dlgDetEliminarTicket" appendTo="@(body)"
					message="¿Desea eliminar este Ticket?" header="Eliminar Ticket"
					severity="alert" widgetVar="dlgEliminarTicket">
				<h:form>
					<p:commandButton value="Eliminar"
						update=":formLista :msgGeneral" 
						actionListener="#{generaTicketMB.confirmaEliminarTicket()}"
						oncomplete="PF('dlgEliminarTicket').hide();" icon="icon-delete" />

					<p:commandButton value="Cancelar" type="button"
						onclick="PF('dlgEliminarTicket').hide()" icon="icon-cancel" />

				</h:form>
			</p:confirmDialog>
			
			<p:dialog header="Consulta Médica" widgetVar="dlgConsultaMedica" appendTo="@(body)"
					resizable="false" id="dlgDetConsultaMedica" modal="true" position="top">
					
					<h:form id="formConsultaMedica">
					<p:messages showDetail="false" showSummary="true" id="msgNuevo1" closable="true"/>
							<h:panelGrid columns="3">
								#{"Ticket: "}
								<h:outputLabel value="#{generaTicketMB.ticketSelected.nro_ticket}"/>
								<p:spacer/>
								#{"Paciente:"}
								<h:outputLabel value="#{generaTicketMB.ticketSelected.desPaciente}"/>
								<p:commandButton value="Historia Clínica"/>
							</h:panelGrid>
					
							<h:panelGrid columns="4">
								
								<p:spacer></p:spacer>
								<p:spacer></p:spacer>
								
								#{"Fecha: "}
								<h:outputText value="#{generaTicketMB.consultaMedica.fecha_consulta}"><f:convertDateTime pattern="dd/MM/yyyy" /></h:outputText>
								
								#{"Tipo Servicio: "}
								<h:outputLabel value="#{generaTicketMB.ticketSelected.desTipoServicio}"/>
								
								#{"Hora: "}
								<h:outputText value="#{generaTicketMB.consultaMedica.hora_consulta}"><f:convertDateTime pattern="HH:mm" /></h:outputText>
								
								#{"Servicio: "}
								<h:outputLabel value="#{generaTicketMB.ticketSelected.desServicio}"/>
								
								#{"Fecha Ticket: "}
								<h:outputText value="#{generaTicketMB.ticketSelected.fecha_ticket}"><f:convertDateTime pattern="dd/MM/yyyy" /></h:outputText>
								
								#{"Médico: "}
								<h:outputLabel value="#{generaTicketMB.ticketSelected.desMedico}"/>
								
								#{"Hora Ticket: "}
								<h:outputText value="#{generaTicketMB.ticketSelected.hora_ticket}"><f:convertDateTime pattern="HH:mm" /></h:outputText>
																
					        </h:panelGrid>	
					        <br/>
					        <p:panelGrid>
					        	
					        	
						        	<p:row>
						        	
						        		<p:column style="font-weight: bold;"> SIGNOS VITALES  </p:column>
						        		
						        		<p:column style="font-weight: bold;"> ANAMNESIS </p:column>
						        		
						        		<p:column style="font-weight: bold;"> LISTADO DE PROBLEMAS </p:column>
						        		
						        		<p:column style="font-weight: bold;"> IMPRESIÓN DIAGNÓSTICA </p:column>
						        		
						        		<p:column style="font-weight: bold;"> EXAMENES AUXILIARES </p:column>
						        		
						        		<p:column style="font-weight: bold;"> DIAGNÓSTICO </p:column>
						        		
						        		<p:column style="font-weight: bold;"> RECETA </p:column>
						        	
						        	</p:row>
					        	
					        		<p:row>
					        	
					        		<p:column>
					        			<h:panelGrid>
						        			<p:commandButton value="Actualizar" actionListener="#{generaTicketMB.actualizarSignoVital()}" update=":dlgDetSignosVitales" 
											 oncomplete="PF('dlgSignosVitales').show();"></p:commandButton>
						        			<h:panelGrid columns="4">
						        			#{"Talla: "}
						        			<h:outputText value="#{generaTicketMB.signoVital.talla}"></h:outputText>
						        			#{"Peso: "}
						        			<h:outputText value="#{generaTicketMB.signoVital.peso}"></h:outputText>
						        			#{"Ocupacion: "}
						        			<h:outputText value="#{generaTicketMB.signoVital.ocupacion}"></h:outputText>
						        			#{"Temperatura: "}
						        			<h:outputText value="#{generaTicketMB.signoVital.temperatura}"></h:outputText>
						        			#{"Alergia: "}
						        			<h:outputText value="#{generaTicketMB.signoVital.alergia}"></h:outputText>
						        			#{"Frec. Cardiaca: "}
						        			<h:outputText value="#{generaTicketMB.signoVital.frecuencia_cardiaca}"></h:outputText>
						        			#{"Frec. Respiratoria: "}
						        			<h:outputText value="#{generaTicketMB.signoVital.frecuencia_respiratoria}"></h:outputText>
						        			#{"Presion Arterial:: "}
						        			<h:outputText value="#{generaTicketMB.signoVital.presion_arterial}"></h:outputText>
						        			</h:panelGrid>
					        			</h:panelGrid>
					        		</p:column>
					        		
					        		<p:column>
					        			<p:inputTextarea value="#{generaTicketMB.consultaMedica.anamesis}"></p:inputTextarea>
					        		</p:column>
					        		
					        		<p:column style="width:250px">
					        			
					        			<h:panelGrid columns="2">
					        			
					        				<p:inputText value="#{generaTicketMB.problema}"><p:ajax event="blur"/></p:inputText>
					        				<p:commandButton icon="icon-add" actionListener="#{generaTicketMB.agregarProblema()}" update=":formConsultaMedica"></p:commandButton>
					        			</h:panelGrid>
					        				
					        				<p:dataTable id="dataProblema"  var="f" value="#{generaTicketMB.listaProblemas}"  widgetVar="dtProblema" 
														 style="FONT-SIZE: 10px; width: 240px">
					        							
					        							<p:column  style="width:150px">
					        								#{f}
					        							</p:column>
					        							
					        							<p:column  style="width:40px" >
					        								<p:commandButton actionListener="#{generaTicketMB.eliminarProblema(f)}" update=":formConsultaMedica" icon="icon-delete"></p:commandButton>
					        							</p:column>
					        				
					        				</p:dataTable>					        				
					        			
					        			
					        		</p:column>
					        		
					        		<p:column>
					        			<p:inputTextarea value="#{generaTicketMB.consultaMedica.impresion_diagnostica}"></p:inputTextarea>
					        		</p:column>
					        		
					        		<p:column style="width:250px">
					        			<h:panelGrid>
						        			<p:commandButton value="Agregar" actionListener="#{generaTicketMB.agregarExamenAuxiliar()}" update=":dlgDetExamenAuxiliar" 
												 oncomplete="PF('dlgExameneAuxiliar').show();"></p:commandButton>
											<p:dataTable id="dataExamenAuxiliar"  var="e" value="#{generaTicketMB.listaExamenAuxiliares}"  widgetVar="dtExamenAuxiliar"
												style="FONT-SIZE: 10px; width: 240px">
												
												<p:column  style="width:150px">
					        						Examen :#{e.producto.descripcion_prod_det} --->Resultado #{e.resultado} : #{e.detalle}
					        					</p:column>
					        							
					        					<p:column  style="width:40px" >
					        						<p:commandButton actionListener="#{generaTicketMB.eliminarExamenAuxiliar(e)}" update=":formConsultaMedica" icon="icon-delete"></p:commandButton>
					        					</p:column>
												
											</p:dataTable>
											
										</h:panelGrid>
					        		</p:column>
					        		
					        		<p:column>
					        			<p:inputTextarea value="#{generaTicketMB.consultaMedica.diagnostico}"></p:inputTextarea>
					        		</p:column>
					        		
					        		<p:column style="width:250px">
					        			<h:panelGrid>
						        			<p:commandButton value="Agregar" actionListener="#{generaTicketMB.agregarReceta()}" update=":dlgDetReceta" 
												 oncomplete="PF('dlgReceta').show();"></p:commandButton>
											<p:dataTable id="dataReceta"  var="r" value="#{generaTicketMB.listaRecetas}"  widgetVar="dtReceta"
												style="FONT-SIZE: 10px; width: 240px">
												
												<p:column  style="width:150px">
					        					  Medicamento: #{r.medicamento} -  Cantidad:#{r.cantidad} - Duracion:#{r.duracion}
					        					</p:column>
					        							
					        					<p:column  style="width:40px" >
					        						<p:commandButton actionListener="#{generaTicketMB.eliminarReceta(r)}" update=":formConsultaMedica" icon="icon-delete"></p:commandButton>
					        					</p:column>
												
											</p:dataTable>
											
										</h:panelGrid>
					        		</p:column>
					        	
					        	</p:row>
					        </p:panelGrid>		
					        	
					        <h:panelGrid >
						        #{"Estado: "}
								<p:selectOneMenu id="cmbEstado" value="#{generaTicketMB.consultaMedica.estado}" style="width:200px;">
									<f:selectItem itemValue="" itemLabel="--Seleccione--"></f:selectItem>
									<f:selectItem itemValue="" itemLabel="PENDIENTE"></f:selectItem>
									<f:selectItem itemValue="" itemLabel="CANCELADO"></f:selectItem>
									<f:selectItem itemValue="" itemLabel="TERMINADO"></f:selectItem>
									<p:ajax event="change"></p:ajax>
								</p:selectOneMenu>
					        </h:panelGrid>	
					        <h:panelGrid>
					        	<p:selectOneRadio id="chn" value="#{generaTicketMB.consultaMedica.tipo_control}" unselectable="true">
						            <f:selectItem itemLabel="CONTROL" itemValue="CONTROL" />
						            <f:selectItem itemLabel="HOSPITALIZACION" itemValue="HOSPITALIZACION" />
						            <f:selectItem itemLabel="NINGUNO" itemValue="NINGUNO" />
						            <p:ajax event="change"></p:ajax>
						        </p:selectOneRadio>
					        </h:panelGrid>
					        	
							<br/> 
							<p:panelGrid>
								<h:panelGroup style="display:block; text-align:center">
									<p:commandButton value="Guardar Consulta" actionListener="#{generaTicketMB.guardarConsultaMedica()}" onclick="PF('dlgConsultaMedica').hide()"
										update=":formConsultaMedica "  icon="icon-disk" rendered="#{generaTicketMB.editarConsulta eq 'FALSE'}"/>
									<p:commandButton value="Actualizar Consulta" actionListener="#{generaTicketMB.actualizarConsultaMedica()}" onclick="PF('dlgConsultaMedica').hide()"
										update=":formConsultaMedica "  icon="icon-disk" rendered="#{generaTicketMB.editarConsulta eq 'TRUE'}" />
									
									<p:commandButton value="Cancelar" type="button" onclick="PF('dlgConsultaMedica').hide()" icon="icon-cancel" />
								</h:panelGroup>
							</p:panelGrid>
					</h:form>	
			</p:dialog>
			
			<p:dialog header="Signos Vitales" widgetVar="dlgSignosVitales" appendTo="@(body)"
					resizable="false" id="dlgDetSignosVitales" modal="true">
			
					<h:form>
					
						<h:panelGrid columns="2">
						
						#{"Talla: "}
						<p:inputText id="talla" value="#{generaTicketMB.signoVital.talla}">
						    <p:ajax event="blur"/>
						</p:inputText>
						
						#{"Ocupación: "}
						<p:inputText id="ocupacion" value="#{generaTicketMB.signoVital.ocupacion}">
						    <p:ajax event="blur"/>
						</p:inputText>
						
						#{"Peso: "}
						<p:inputText id="peso" value="#{generaTicketMB.signoVital.peso}">
						    <p:ajax event="blur"/>
						</p:inputText>
						
						#{"Temperatura: "}
						<p:inputText id="temperatura" value="#{generaTicketMB.signoVital.temperatura}">
						    <p:ajax event="blur"/>
						</p:inputText>
						
						#{"Alergia: "}
						<p:inputText id="alergia" value="#{generaTicketMB.signoVital.alergia}">
						    <p:ajax event="blur"/>
						</p:inputText>
						
						#{"Frecuencia Cardiaca: "}
						<p:inputText id="frec_card" value="#{generaTicketMB.signoVital.frecuencia_cardiaca}">
						    <p:ajax event="blur"/>
						</p:inputText>
						
						#{"Frecuencia Respiratoria: "}
						<p:inputText id="frec_resp" value="#{generaTicketMB.signoVital.frecuencia_respiratoria}">
						    <p:ajax event="blur"/>
						</p:inputText>
						
						#{"Presión Arterial: "}
						<p:inputText id="pres_arte" value="#{generaTicketMB.signoVital.presion_arterial}">
						    <p:ajax event="blur"/>
						</p:inputText>
						
						#{"Embarazada: "}
						<p:inputText id="embarazo" value="#{generaTicketMB.signoVital.embarazo}">
						    <p:ajax event="blur"/>
						</p:inputText>
						
						#{"Otros 1: "}
						<p:inputText id="otros1" value="#{generaTicketMB.signoVital.otros1}">
						    <p:ajax event="blur"/>
						</p:inputText>
						
						#{"Otros 2: "}
						<p:inputText id="otros2" value="#{generaTicketMB.signoVital.otros2}">
						    <p:ajax event="blur"/>
						</p:inputText>
						
						#{"Otros 3: "}
						<p:inputText id="otros3" value="#{generaTicketMB.signoVital.otros3}">
						    <p:ajax event="blur"/>
						</p:inputText>
						
						#{"Sat 02: "}
						<p:inputText id="sat_oxigeno" value="#{generaTicketMB.signoVital.sat_oxigeno}">
						    <p:ajax event="blur"/>
						</p:inputText>
						
						</h:panelGrid>
						
						<br/>
						<p:commandButton value="Aceptar" actionListener="#{generaTicketMB.confirmarActualizarSignoVital()}"
							update=":formConsultaMedica" oncomplete="PF('dlgSignosVitales').hide();" icon="icon-disk" />
						
						<p:commandButton value="Cancelar" type="button" onclick="PF('dlgSignosVitales').hide()" icon="icon-cancel" />
					
					</h:form>
					
			</p:dialog>
			
			<p:dialog header="Examen Auxiliar" widgetVar="dlgExameneAuxiliar" appendTo="@(body)"
					resizable="false" id="dlgDetExamenAuxiliar" modal="true">
					
					<h:form>
					
						<h:panelGrid columns="2">
						
							#{"Tipo Servicio: "}
								<p:selectOneMenu id="cmbTipoEX" value="#{generaTicketMB.id_tipo_servicio_EX}" style="width:200px;" >
									<f:selectItem itemValue="" itemLabel="--Seleccione--"></f:selectItem>
									<f:selectItems value="#{generaTicketMB.listTipoServicios}" var="p" 
									itemLabel="#{p.descripcion_tipo}" itemValue="#{p.id_tipo_servicio}" />
									<p:ajax listener="#{generaTicketMB.cargarServiciosEX()}" update="cmbServicioEX"></p:ajax>
								</p:selectOneMenu>	
								
								#{"Servicio: "}
								<p:selectOneMenu id="cmbServicioEX" value="#{generaTicketMB.id_producto_EX}" style="width:200px;">
									<f:selectItem itemValue="" itemLabel="--Seleccione--"></f:selectItem>
									<f:selectItems value="#{generaTicketMB.listProductos}" var="p" 
									itemLabel="#{p.descripcion_prod_det}" itemValue="#{p.id_producto}" />
									<p:ajax event="change" listener="#{generaTicketMB.cargaProductoEX()}"></p:ajax>
								</p:selectOneMenu>
						
						</h:panelGrid>
					
					</h:form>
					
					<br/>
					<p:commandButton value="Agregar" actionListener="#{generaTicketMB.confirmarAgregarExamenAuxiliar()}"
						update=":formConsultaMedica" oncomplete="PF('dlgExameneAuxiliar').hide();" icon="icon-disk" />
						
					<p:commandButton value="Cancelar" type="button" onclick="PF('dlgExameneAuxiliar').hide()" icon="icon-cancel" />
					
			</p:dialog>
			
			<p:dialog header="Receta" widgetVar="dlgReceta" appendTo="@(body)"
					resizable="false" id="dlgDetReceta" modal="true">
					
					<h:form>
					
						<h:panelGrid>
						
							#{"Medicamento: "}
							<p:inputText id="resultado" value="#{generaTicketMB.receta.medicamento}">
							    <p:ajax event="blur"/>
							</p:inputText>
							
							#{"Cantidad: "}
							<p:inputText id="cantidad" value="#{generaTicketMB.receta.cantidad}">
							    <p:ajax event="blur"/>
							</p:inputText>
							
							#{"Dosis: "}
							<p:inputText id="dosis" value="#{generaTicketMB.receta.dosis}">
							    <p:ajax event="blur"/>
							</p:inputText>
							
							#{"Horas: "}
							<p:inputText id="horas" value="#{generaTicketMB.receta.horas}">
							    <p:ajax event="blur"/>
							</p:inputText>
							
							#{"Duración: "}
							<p:inputText id="duracion" value="#{generaTicketMB.receta.duracion}">
							    <p:ajax event="blur"/>
							</p:inputText>
						
						</h:panelGrid>
					
					</h:form>
					
					<br/>
					<p:commandButton value="Agregar" actionListener="#{generaTicketMB.confirmarAgregarReceta()}"
						update=":formConsultaMedica" oncomplete="PF('dlgReceta').hide();" icon="icon-disk" />
						
					<p:commandButton value="Cancelar" type="button" onclick="PF('dlgReceta').hide()" icon="icon-cancel" />
					
			</p:dialog>
		</p:panel>
		
		<script>
			
		function validarTicket(xhr, status, args) {
			if (!args.esValido) {
				jQuery('#dlgDetNuevoTicket').effect("shake", {
					times : 1
				}, 100);
				console.log("No cerro")
			} else {
				//limpiando
				PF('dlgNuevoTicket').hide();
				console.log("cerro")
			}
		}

		</script>
		
	</ui:define>
</ui:composition>
</html>